<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>		
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
		<style type="text/css" media="screen">
			.number {
				position: relative;
				cursor: move;
				border: 1px solid black;
				padding: 12px;
			}
			
			.over {
				border: 1px dotted black;
			}
			
			#number-list {
				list-style-type: none;
			}
		</style>	
		<title>The Fun Sorting Game</title>
	</head>
	<body>
		<div id="games-played-container"></div>
		<ul id="number-list" class="sortable">
		</ul>
 
		<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
		<script>
			//! Field Variables
			var numberList = $('#number-list'),
				gamesPlayedContainer = $('#games-played-container'),
				numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
				
			setup = function () {
				// Shuffle numbers
				numbers = numbers.sort(function () { return .5 - Math.random()});

				// Insert numbers into clean list
				numberList.html('');
				for (var numberIndex in numbers) {
					numberList.append('<li class="number">'+ numbers[numberIndex] +'</li>');
				}
				if(typeof(Storage) !== 'undefined') {
					gamesPlayedContainer.html('Du har spillet: <strong>'+ localStorage.gamesPlayed +'</strong> spil');
				}
			},
		
			stopHandler = function (e) {
				console.log(checkSorted(numberList));
				if (checkSorted(numberList)) {
					if (confirm('You have won the sorting game! Try again?')) {
						if(typeof(Storage) !== 'undefined') {
							localStorage.gamesPlayed = parseInt(localStorage.gamesPlayed) + 1;
						}
						setup();
					}
				}
			},
			
			checkSorted = function (list) {
				var sorted = true,
					lastNumber = 0;
				$.each(list.children(), function (index, element) {
					element = $(element);
					var currentNumber = parseInt(element.html());
					if (currentNumber < lastNumber) {
						sorted = false;
					}
					lastNumber = currentNumber;
				});
				return sorted;
			};	
			
			$(function() {
				setup();
				$( ".sortable" ).sortable({
					stop: stopHandler
				});
			    $( ".sortable" ).disableSelection();
			});
		</script>
	</body>
</html>